if(!window.qz){var qz=function(){var r={VERSION:"2.2.4",DEBUG:!1,log:{trace:function(e,...t){r.DEBUG&&console.log(e,...t)},err:function(e,t){r.DEBUG&&(console.error(e,t),t&&t.stack&&console.error(t.stack))},socketError:function(e,t){if(Array.isArray(e)){if(void 0===e[0])return void r.log.err("Unknown socket error");r.log.err(e[0],t),e=e[0]}else r.log.err(e,t);r.ws&&r.ws.send("closed::"+e),r.cfgSocket&&r.cfgSocket.ws&&r.cfgSocket.ws.send("closed::"+e)}},streams:{serial:"SERIAL",usb:"USB",hid:"HID",printer:"PRINTER",file:"FILE",socket:"SOCKET"},ws:null,cfgSocket:{},websocketSuccess:!1,reconnect:{time:0,count:0,max:3,delay:5},connectTimeout:5,userClose:!1,deviceSearchParameters:{USB:["vendorId","productId","usb","usbClass","usbSubClass","usbProtocol","hidUsage","hidUsagePage","interface"],HID:["vendorId","productId","usb","usbClass","usbSubClass","usbProtocol","hidUsage","hidUsagePage","interface","serial","manufacturer"],SERIAL:["vendorId","productId","usb","usbClass","usbSubClass","usbProtocol","hidUsage","hidUsagePage","interface"],SOCKET:["host","port"],PRINTER:["name"]},printerCommandTypes:{RAW:"RAW",PS:"PS",PDF:"PDF",ESCPOS:"ESCPOS",ZPL:"ZPL",EPL:"EPL",BIN:"BIN",BINARY:"BINARY"},lastPrintData:null,lastPrintRaw:null,lastPrintFile:null,defaultConfig:{host:["localhost","localhost.qz.io"],usingSecure:!0,keepAlive:60,retries:0,delay:0,maxPrinterCallbacks:1,usePrinterName:!1,singlePrinterName:null,altPrinting:!1,alternatePrinter:null,recentPrinterName:null},connectionQueue:[],deployVersion:0,startTime:0,processingTime:0,processing:!1,pendingProcessing:!1,sslH:"wss://",encryption:null,signature:null,certificateSha1:null,certificatePromise:null,savePath:"",saveFile:[],saveBuffer:[],trigger:null,cookiePath:"",cookieParams:[],cookieSaved:!1};function e(){if(void 0!==RSVP)return r.log.trace("Using global RSVP"),RSVP;try{return r.log.trace("Using imported RSVP"),require("rsvp")}catch(e){return r.log.warn("RSVP not found"),null}}var t=e();function n(e){return!(!e||!0!==e&&"true"!==e)}function o(e,t){return void 0!==e[t.def]&&void 0!==t.suppressible&&void 0!==e[t.suppressible]&&n(e[t.suppressible])}function s(e,t){return o(e,t)?n(e[t.suppressible])?e[t.def]:void 0:e[t.def]}function i(e,t){return void 0!==e[t.def]?e[t.def]:t.defValue}function c(e,t,r){void 0!==e[t.name]&&(r[t.name]="object"===t.type?Object.assign({},e[t.name]):"array"===t.type?e[t.name].slice():e[t.name])}function a(e,t,r){void 0!==e[t.name]&&("object"===t.type?r[t.name]=Object.assign({},e[t.name]):r[t.name]=e[t.name],"number"==typeof r[t.name]&&r[t.name]>=1&&(r[t.name]/=t.scaling))}function l(e,r){return new t.Promise((function(t,n){try{t(r?r(e):e)}catch(e){n(e)}}))}function u(e){if(void 0!==e)return"function"==typeof e?e():e;return null}function g(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(t){return e}}function d(){return Math.floor(16777216*Math.random()).toString(16).substring(1)}function p(e){return e&&e.length&&e.substring&&"\\u"==e.substring(0,2)&&e.length>=6}function h(e){return p(e)?String.fromCharCode(parseInt(e.substring(2),16)):e}function f(e){if(r.tools.isArray(e)){for(var t=0;t<e.length;t++)"object"==typeof e[t]?e[t]=f(e[t]):e[t]=h(e[t]);return e}return h(e)}function m(e){return e}function v(e,t){for(var r in e)if(e.hasOwnProperty(r)){if("__type__"===r)continue;if(Array.isArray(e[r]))t[r]=e[r].slice();else if("object"==typeof e[r]&&null!==e[r]){void 0===t[r]&&(t[r]={});v(e[r],t[r])}else t[r]=e[r]}}function w(e,r,n,o){if(!t)throw new Error("RSVP not loaded. Cannot support chaining calls. See qz.api.setPromiseType");if("string"==typeof e){if(!r.api.callbacks[e])throw new Error("Cannot find saved callback: "+e);e=r.api.callbacks[e]}"object"!=typeof r&&"function"!=typeof r&&(void 0!==r?r=[r]:r=[]);var s=void 0!==n?n:{},i;if(o&&"number"==typeof o&&o>0){i=new t.Promise((function(t,n){e().then((function(e){s={data:e,count:o-1},t(s)}),(function(e){s={error:e,count:o},t(s)}))}))}else i=l(e());return i}if(void 0!==window&&window.navigator&&navigator.userAgent&&navigator.userAgent.match(/Firefox\/([^ )\]]+)/)){var b=navigator.userAgent.match(/Firefox\/([^ )\]]+)/);b[1]&&parseFloat(b[1])>=61&&"function"==typeof window.createImageBitmap&&!window.TouchEvent&&(window._createImageBitmap=window.createImageBitmap,window.createImageBitmap=function(e,...t){const r=t[t.length-1];let n;0!==t.length&&void 0!==r&&"object"==typeof r?(void 0!==r.imageOrientation||void 0!==r.premultiplyAlpha||void 0!==r.colorSpaceConversion||void 0!==r.resizeWidth||void 0!==r.resizeHeight||void 0!==r.resizeQuality)?(n=r,t.pop()):n=null:n=null;return n&&"none"===n.premultiplyAlpha?new Promise((function(r,n){window._createImageBitmap.apply(this,[e,...t]).then((r=>{var o=document.createElement("canvas");o.width=r.width,o.height=r.height;const s=o.getContext("2d");s.drawImage(r,0,0),r&&r.close&&r.close();const i=s.getImageData(0,0,o.width,o.height);for(let e=0;e<i.data.length;e+=4)0===i.data[e+3]&&(i.data[e]=0,i.data[e+1]=0,i.data[e+2]=0);s.putImageData(i,0,0),window._createImageBitmap.apply(this,[o,0,0,o.width,o.height]).then((n=>{Object.defineProperty(n,"width",{writable:!1,value:r.width}),Object.defineProperty(n,"height",{writable:!1,value:r.height}),r(n)}),(function(e){n(e)}))}),(function(e){n(e)}))})):window._createImageBitmap.apply(this,[e,...t])},r.log.trace("Applied Firefox createImageBitmap fix"))}function y(){this.api=r.api={edition:null,title:null,version:{},dispatchPromise:function(e,r){return e(new t.Promise((function(t,n){e=t,r=n}))),{resolve:e,reject:r}},promiseType:function(){return"RSVP"},setPromiseType:function(e){var t=!0;switch(e){case"esPromise":case"RSVP":case"Q":case"Angular":break;default:t=!1}return!!t&&(r.api.dispatchPromise=function(t,n){switch(e){case"esPromise":t(new Promise((function(e,r){t=e,n=r})));break;case"RSVP":t(new RSVP.Promise((function(e,r){t=e,n=r})));break;case"Q":var o=r.tools.ws.getVariable("Q"),s=o?o.defer():{resolve:t,reject:n};t(s.promise),t=s.resolve,n=s.reject;break;case"Angular":var o=r.tools.ws.getVariable("$q");if(o){var s=o.defer();t(s.promise),t=s.resolve,n=s.reject}}return{resolve:t,reject:n}},r.api.promiseType=function(){return e},r.log.trace("Promise type: "+e),!0)},api:function(){return r.websocket.init()},isActive:function(e){return"boolean"==typeof e&&(r.log.warn("Boolean isActive() is deprecated. Please use config object instead."),e={usingSecure:e}),void 0!==e&&"object"!=typeof e&&(r.log.warn("Unrecognized parameter for isActive(): "+e),e=void 0),r.tools.promise((function(t,n){var o=r.websocket.isActive(e);o?t(o):n(o)}))},connect:function(){return r.websocket.connect()},disconnect:function(){return r.websocket.disconnect()},printers:function(){return r.websocket.dataPromise("printers")},defaultPrinter:function(){return r.websocket.dataPromise("defaultPrinter")},getFileInfo:function(){return r.websocket.dataPromise("getFileInfo")},getSystemProperty:function(e){return r.websocket.dataPromise("getSystemProperty",{property:e})},getSystemProperties:function(){return r.websocket.dataPromise("getSystemProperties")},getNetworkInfo:function(e){var t={};return e&&(t.printer=e),r.websocket.dataPromise("getNetworkInfo",t)},getConnectedDevices:function(e){return r.websocket.dataPromise("getConnectedDevices",e)},callbacks:{error:m,printerList:null,printerStatus:null,networkInfo:null,fileInfo:null,systemInfo:null,usbInfo:null,displayUID:null,displayRemoved:null},security:{setCertificatePromise:function(e){return r.tools.promise((function(t,n){try{r.security.setCertificate(e,t)}catch(e){n(e)}}))}},setPromiseLib:function(e){return r.api.setPromiseType(e)},setPromiseReference:function(e){r.security.callbackRef=e},getVersion:function(){return r.VERSION},getQZVersion:function(){return r.websocket.dataPromise("getVersion")},setWebsocket:function(e){r.tools.ws.connection=e},setWebsocketActive:function(e){r.tools.ws.connection.full=e},setDebug:function(e){r.DEBUG=e},getDebug:function(){return r.DEBUG}},this.compatibility=r.compatibility={setCertificationCompatibility:function(e){if(void 0!==e.warnMultiple&&(r.compatibility.warnMultiple=e.warnMultiple),void 0!==e.ca)if("string"==typeof e.ca)r.compatibility.caCerts.push(e.ca);else if(Array.isArray(e.ca))r.compatibility.caCerts=r.compatibility.caCerts.concat(e.ca);else{r.log.warn("Unknown CA Type:",e.ca)}},getCertificationCompatibility:function(){return{warnMultiple:r.compatibility.warnMultiple,ca:r.compatibility.caCerts}},setSignatureAlgorithm:function(e){return r.compatibility.setAlgorithm(e)}},this.hid=r.hid={listDevices:function(e){return r.websocket.dataPromise("hid.listDevices",e)},openStream:function(e){var t={type:"open"};return S(e),r.websocket.dataPromise("hid.openStream",e,t)},closeStream:function(e){var t={type:"close"};return S(e),r.websocket.dataPromise("hid.closeStream",e,t)},setHidCallbacks:function(e){r.hid.handleHidData=e.processData,r.hid.handleHidClaimed=e.claimed,r.hid.handleHidClosed=e.closed,r.hid.handleHidError=e.error,r.hid.handleHidPacket=e.packet},setHidDataCallback:function(e){r.hid.handleHidData=e,r.log.warn("setHidDataCallback is deprecated. Please use setHidCallbacks instead.")},setHidClaimedCallback:function(e){r.hid.handleHidClaimed=e,r.log.warn("setHidClaimedCallback is deprecated. Please use setHidCallbacks instead.")},setHidClosedCallback:function(e){r.hid.handleHidClosed=e,r.log.warn("setHidClosedCallback is deprecated. Please use setHidCallbacks instead.")},setHidErrorCallback:function(e){r.hid.handleHidError=e,r.log.warn("setHidErrorCallback is deprecated. Please use setHidCallbacks instead.")},setHidRawPacketCallback:function(e){r.hid.handleHidPacket=e,r.log.warn("setHidRawPacketCallback is deprecated. Please use setHidCallbacks instead.")}};function S(e){if(e&&e.devices)if(Array.isArray(e.devices))for(var t=0;t<e.devices.length;t++)r.tools._normalizeHidOutput(e.devices[t]);else"object"==typeof e.devices&&(r.tools._normalizeHidOutput(e.devices),e.devices=[e.devices])}this.serial=r.serial={findPorts:function(){return r.websocket.dataPromise("serial.findPorts")},openPort:function(e){var t={type:"open"};return r.websocket.dataPromise("serial.openPort",e,t)},sendData:function(e){var t={type:"send"};if(e&&void 0!==e.data){if("number"==typeof e.data&&(e.data=[e.data]),"string"==typeof e.data||Array.isArray(e.data))return r.websocket.dataPromise("serial.sendData",e,t)}return r.tools.promise((function(e,t){t(new Error("Cannot send serial data: 'data' property is invalid or missing"))}))},closePort:function(e){return e&&void 0===e.port?r.tools.promise((function(e,t){t(new Error("Cannot close serial port: 'port' property is missing"))})):r.websocket.dataPromise("serial.closePort",e,{type:"close"})},setSerialCallbacks:function(e){r.serial.handleSerialData=e.processData,r.serial.handleSerialDiscovered=e.portDiscovered,r.serial.handleSerialOpened=e.portOpen,r.serial.handleSerialClosed=e.portClosed,r.serial.handleSerialError=e.error,r.serial.handleSerialReceived=e.dataReceived},setSerialDataCallback:function(e){r.serial.handleSerialData=e,r.log.warn("setSerialDataCallback is deprecated. Please use setSerialCallbacks instead.")},setSerialOpenedCallback:function(e){r.serial.handleSerialOpened=e,r.log.warn("setSerialOpenedCallback is deprecated. Please use setSerialCallbacks instead.")},setSerialClosedCallback:function(e){r.serial.handleSerialClosed=e,r.log.warn("setSerialClosedCallback is deprecated. Please use setSerialCallbacks instead.")},setSerialPortDiscoveredCallback:function(e){r.serial.handleSerialDiscovered=e,r.log.warn("setSerialPortDiscoveredCallback is deprecated. Please use setSerialCallbacks instead.")},setSerialErrorCallback:function(e){r.serial.handleSerialError=e,r.log.warn("setSerialErrorCallback is deprecated. Please use setSerialCallbacks instead.")},setSerialDataReceivedCallback:function(e){r.serial.handleSerialReceived=e,r.log.warn("setSerialDataReceivedCallback is deprecated. Please use setSerialCallbacks instead.")}},this.scales=r.scales={findScales:function(e){return r.websocket.dataPromise("scales.findScales",e)},openScaleStream:function(e){var t={type:"open"},n=function(e){e&&(e.scale&&"string"==typeof e.scale&&(e.scale={name:e.scale}),e.scale.hasOwnProperty("vendorId")&&"string"!=typeof e.scale.vendorId&&(e.scale.vendorId?e.scale.vendorId=e.scale.vendorId.toString(16):delete e.scale.vendorId),e.scale.hasOwnProperty("productId")&&"string"!=typeof e.scale.productId&&(e.scale.productId?e.scale.productId=e.scale.productId.toString(16):delete e.scale.productId))};return n(e),r.websocket.dataPromise("scales.openScaleStream",e,t)},closeScaleStream:function(e){var t={type:"close"},n=function(e){e&&(e.scale&&"string"==typeof e.scale&&(e.scale={name:e.scale}),e.scale.hasOwnProperty("vendorId")&&"string"!=typeof e.scale.vendorId&&(e.scale.vendorId?e.scale.vendorId=e.scale.vendorId.toString(16):delete e.scale.vendorId),e.scale.hasOwnProperty("productId")&&"string"!=typeof e.scale.productId&&(e.scale.productId?e.scale.productId=e.scale.productId.toString(16):delete e.scale.productId))};return n(e),r.websocket.dataPromise("scales.closeScaleStream",e,t)},setScaleCallbacks:function(e){r.scales.handleScaleData=e.processData,r.scales.handleScaleWeighing=e.weighing,r.scales.handleScaleClaimed=e.claimed,r.scales.handleScaleClosed=e.closed,r.scales.handleScaleError=e.error},setScaleDataCallback:function(e){r.scales.handleScaleData=e,r.log.warn("setScaleDataCallback is deprecated. Please use setScaleCallbacks instead.")},setScaleWeighingCallback:function(e){r.scales.handleScaleWeighing=e,r.log.warn("setScaleWeighingCallback is deprecated. Please use setScaleCallbacks instead.")},setScaleClaimedCallback:function(e){r.scales.handleScaleClaimed=e,r.log.warn("setScaleClaimedCallback is deprecated. Please use setScaleCallbacks instead.")},setScaleClosedCallback:function(e){r.scales.handleScaleClosed=e,r.log.warn("setScaleClosedCallback is deprecated. Please use setScaleCallbacks instead.")},setScaleErrorCallback:function(e){r.scales.handleScaleError=e,r.log.warn("setScaleErrorCallback is deprecated. Please use setScaleCallbacks instead.")}},this.cash=r.cash={openDrawer:function(e,t){var n={port:e};return r.websocket.dataPromise("cash.openDrawer",Object.assign(n,t))},setDrawerStatus:function(e){r.cash.handleCashStatus=e}},this.usb=r.usb={listDevices:function(e){return navigator.usb?r.tools.promise((function(e,t){navigator.usb.getDevices?e(navigator.usb.getDevices()):t(new Error("This browser does not support device listing"))})):r.tools.promise((function(e,t){t(new Error("This browser does not support WebUSB"))}))},requestDevice:function(e){return navigator.usb?r.tools.promise((function(t,n){if(!navigator.usb.requestDevice)return void n(new Error("This browser does not support requestDevice"));if(!e||!e.filters||!Array.isArray(e.filters)){if(!(e&&e.filters&&e.filters.hasOwnProperty("vendorId")))return void n(new Error("Missing or invalid 'filters' parameter"));e.filters=[e.filters]}try{navigator.usb.requestDevice(e).then((function(e){t(e)})).catch((function(e){n(e)}))}catch(e){n(e)}})):r.tools.promise((function(e,t){t(new Error("This browser does not support WebUSB"))}))}},this.display=r.display={findDisplays:function(){return r.websocket.dataPromise("display.findDisplays")},startListener:function(e){return r.websocket.dataPromise("display.startListener",e,{type:"started"})},stopListener:function(){return r.websocket.dataPromise("display.stopListener")},requestDisplay:function(e){return r.websocket.dataPromise("display.requestDisplay",e,{type:"found"})},getDisplayByUID:function(e){return r.websocket.dataPromise("display.getDisplayByUID",{uid:e})},clear:function(e,t){return t&&"boolean"==typeof t.clear&&!t.clear?r.websocket.dataPromise("display.resetDisplay",{display:e}):r.websocket.dataPromise("display.clearDisplay",{display:e})},showText:function(e,t){var n={display:e,data:t.data,row:t.row,col:t.col};return!1===t.clear?r.websocket.dataPromise("display.writeText",n):r.websocket.dataPromise("display.clearWrite",n)},showImage:function(e,t){var n={display:e};if(t){if(n.image=t.data,n.color=t.color,n.threshold=t.threshold,n.invert=t.invert,n.optimize=t.optimize,n.rotation=t.rotation,n.flipX=t.flipX,n.flipY=t.flipY,!n.image)throw new Error("Parameter 'data' is required for display.showImage")}return t&&!1===t.clear?r.websocket.dataPromise("display.writeImage",n):r.websocket.dataPromise("display.clearImage",n)},enableScreensaver:function(e,t){return void 0!==t&&!1!==t||(t=!0),r.websocket.dataPromise("display.enableScreensaver",{display:e,enabled:t})},setScreensaverInterval:function(e,t){return r.websocket.dataPromise("display.setScreensaverInterval",{display:e,interval:t})},setScreensaverImages:function(e,t){return r.websocket.dataPromise("display.setScreensaverImages",{display:e,images:t})},setScreensaverText:function(e,t){return r.websocket.dataPromise("display.setScreensaverText",{display:e,text:t})},setDisplayCallback:function(e){r.display.displayCallbacks.display=e},setDisplayRemovedCallback:function(e){r.display.displayCallbacks.removed=e},statusListener:function(e){return r.display.displayCallbacks=e,r.tools.promise((function(e,t){r.display.statusHandler={resolve:e,reject:t},r.websocket.dataPromise("display.addListener",null,{type:"change"}).catch((function(e){r.display.statusHandler=null,t(e)}))}))},clearListeners:function(){return r.display.displayCallbacks={},r.websocket.dataPromise("display.clearListeners")}},this.security=r.security={setPromiseLibrary:function(e){r.security.promise=e},setCertificate:function(e,t){return e=e||{},function(e,t){r.log.trace("Setting certificate"),!1!==e.signed&&(e.host||(e.host="localhost.qz.io")),e.host||(e.host=null);var n=null;r.certificateSha1=null;var o=null;if(e.alias&&"function"==typeof e.alias.load&&!e.certfile&&(e.certfile=e.alias),e.certfile&&"function"==typeof e.certfile.getPublicKey)try{o=e.certfile.getPublicKey(),n=o}catch(e){r.log.err(e)}return e.certfile&&e.certfile.certificate&&(n=e.certfile.certificate,o||(o=r.tools.extractCertData(n,"PUBLIC"))),r.certificatePromise=function(e,t){o?e(o):n?t(new Error("Public key data could not be retrieved from certificate")):t(new Error("No certificate available"))},r.security.callbackRef=t,r.websocket.isActive()&&r.websocket.send(r.websocket.getStream("security.setCertificate",e,n)),t&&t(o),o}(e,t)},setSigningMechanism:function(e){"string"==typeof e?(r.log.warn("String parameter for setSigningMechanism has been deprecated."),r.signAlgorithm=e):e.signMethod?"NONE"===e.signMethod.toUpperCase()?r.signingEnabled=!1:(r.signingEnabled=!0,r.signatureFactory=e):r.log.warn("No signature method was provided, secure websockets not guaranteed by formatter.")},setSignaturePromise:function(e){r.security.promise=e},sign:function(e,t,n){return"function"==typeof t?(r.tools.isBase64(e)&&(e=r.tools.getBase64Value(e)),r.tools.promise(r.security.promise,n,(function(r,n){try{t(e,r)}catch(e){n(e)}}))):r.signatureFactory?r.signatureFactory(e):r.tools.promise(r.security.promise,n,(function(e,t){t(new Error("A signature method must be set"))}))}},r.compatibility={protected:["#qz-backdrop","#qz-widget","#qz-flipper","#qz-wrapper"],warnMultiple:!0,caCerts:[],isBlocked:function(e){try{var t=e.toString();return t.indexOf("setKeyAlias")>-1||t.indexOf("keystore")>-1||t.indexOf("Failed to execute operation")>-1&&(r.tools.isFirefox()||t.indexOf("iterate")>-1)}catch(e){return!1}},displays:{toResetTimeouts:{},toCloseTimeouts:{}},authTypes:{NONE:0,BASIC:1,CERTIFICATE:2},authStatuses:{UNKNOWN:0,REQUEST_NA:1,PENDING:2,ACCEPTED:3,DENIED:4},VERSION_LOOKUP:["getQZVersion","qzVersion","qz.version"],finance:{},setAlgorithm:function(e){return void 0!==e&&"string"==typeof e&&["SHA1","SHA256","SHA512"].indexOf(e.toUpperCase())>-1&&(r.log.warn("Forced signature algorithm: "+(e=e.toUpperCase())),r.signAlgorithm=e,!0)}},this.logging=r.logging={setLevel:function(e){return r.websocket.dataPromise("logging.setLevel",{level:e})},getLevel:function(){return r.websocket.dataPromise("logging.getLevel")},getLogFiles:function(e=5){return r.log.trace("Request log files"),r.websocket.dataPromise("logging.getLogFiles",{limit:e})},getLogFile:function(e,t=0,n){return r.log.trace(`Request log file: ${e} limit: ${t} filter: ${n}`),r.websocket.dataPromise("logging.getLogFile",{fileName:e,limit:t,filter:n})},getDataFile:function(e,t=0,n){return r.log.trace(`Request data file: ${e} limit: ${t} filter: ${n}`),r.websocket.dataPromise("logging.getDataFile",{fileName:e,limit:t,filter:n})},clearLogFiles:function(){return r.log.trace("Clear logs files"),r.websocket.dataPromise("logging.clearLogFiles")},send:function(e,t){return r.websocket.dataPromise("logging.sendLog",{level:e,message:t})}},this.bluetooth=r.bluetooth={findDevices:function(e){return r.websocket.dataPromise("bluetooth.findDevices",e)}},this.websocket=r.websocket={isActive:function(e){return r.websocket.status(e)},connect:function(e){return r.tools.promise((function(t,n){if(r.websocket.isActive())try{r.websocket.setup.findConnection(e,t,n)}catch(e){n(e)}else r.websocket.isConnected()?t():r.websocket.setup.isUserConnectOpen()?n(new Error("Connection request already open")):r.websocket.setup.connectOnce(e,t,n)}))},disconnect:function(){return r.tools.promise((function(e,t){if(r.websocket.isActive())try{r.websocket.shutdown();let n=setTimeout((function(){r.log.warn("Disconnect handling took too long"),r.websocket.connection=null,e()}),1e3);r.websocket.closedWhenDone=function(){clearTimeout(n),e()}}catch(e){t(e)}else t(new Error("No active connection with QZ"))}))},status:function(e){return r.tools.promise((function(t,n){if(!r.websocket.connection)return n(new Error("No connection to QZ Tray"));r.websocket.connection.promise?r.websocket.connection.promise.dummy?t([!0,null]):t([!1,null]):try{r.websocket.dataPromise("websocket.getStatus",e||{}).then((function(e){t([!0,e])})).catch((function(e){r.log.error(e),t([!0,null])}))}catch(e){n(e)}}))}},this.storager=r.storager={saveState:function(e,t,n,o=!1){return r.websocket.dataPromise("storager.saveState",{store:e,key:t,value:n,remember:o})},listenToStorage:function(e,t,n=!1){return r.websocket.dataPromise("storager.listenToStorage",{store:e,key:t,remember:n})},removeFromStorage:function(e,t){return r.websocket.dataPromise("storager.removeFromStorage",{store:e,key:t})},setStorageCallbacks:function(e){r.storager.handleStorageData=e.processData,r.storager.handleStorageStored=e.stored,r.storager.handleStorageFound=e.storageFound,r.storager.handleStorageRemoved=e.storageRemoved,r.storager.handleStorageError=e.error}},this.file=r.file={setFileHandlers:function(e){r.file.writeHandlers=e.processData,r.file.writeHandlers=e.written,r.file.readHandlers=e.read,r.file.errorHandlers=e.error,r.log.warn("This function is deprecated. Please use qz.file.setFileCallbacks instead")},setFlatFileCallbacks:function(e){r.file.handleFileData=e.processData,r.file.handleFileWritten=e.written,r.file.handleFileRead=e.read,r.file.handleFileError=e.error},setFileCallbacks:function(e){r.file.handleFileData=e.processData,r.file.handleFileWritten=e.written,r.file.handleFileRead=e.read,r.file.handleFileError=e.error,r.file.handleFileListing=e.listed,r.file.handleFileDeleted=e.deleted,r.file.handleFileItem=e.item},write:function(e,t,n){var o={path:e,data:t};return n&&"object"==typeof n&&v(n,o),r.websocket.dataPromise("file.write",o,{type:"write"})},read:function(e,t){var n={path:e};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},remove:function(e,t){var n={path:e};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.remove",n,{type:"remove"})},list:function(e,t){var n={path:e};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.list",n,{type:"list"})},readAsArrayBuffer:function(e,t){var n={path:e,dataType:"bytes"};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},readAsText:function(e,t){var n={path:e,dataType:"string"};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},readAsJSON:function(e,t){var n={path:e,dataType:"json"};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},readAsBase64:function(e,t){var n={path:e,dataType:"base64"};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},readAsArray:function(e,t){var n={path:e,dataType:"array"};return t&&"object"==typeof t&&v(t,n),r.websocket.dataPromise("file.read",n,{type:"read"})},getSize:function(e,t){var n={path:e,dataType:"size
